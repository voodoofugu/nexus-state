import{useRef as t,useEffect as e,useReducer as n,useSyncExternalStore as c}from"react";function s(t){const{state:e,acts:n}=t;let c=Object.assign({},e);const s=new Map,o=[],r=t=>{var e;"*"===t?s.forEach((t=>t.forEach((t=>t())))):(t.forEach((t=>{var e;return null===(e=s.get(t))||void 0===e?void 0:e.forEach((t=>t()))})),null===(e=s.get("*"))||void 0===e||e.forEach((t=>t())))};function i(t){return void 0!==t?c[t]:c}const a=t=>{const e=Object.assign({},c),n="function"==typeof t?t(e):t;let s=Object.assign(Object.assign({},c),n);for(const t of o){const n=t(e,s);void 0!==n&&(s=n)}const i=[];for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&c[t]!==s[t]&&i.push(t);i.length&&(c=s,r(i))},u={};if(Array.isArray(n))for(const t of n){const e=t.call(u,i,a);e&&"object"==typeof e&&Object.assign(u,e)}else if("function"==typeof n){const t=n.call(u,i,a);t&&"object"==typeof t&&Object.assign(u,t)}for(const t of Object.keys(u)){const e=u[t];"function"==typeof e&&(u[t]=e.bind(u))}return{get:i,set:a,reset:function(...t){if(0===t.length)c=Object.assign({},e),r("*");else{const n={};for(const c of t)c in e&&(n[c]=e[c]);c=Object.assign(Object.assign({},c),n),r(t)}},subscribe:(t,e)=>{if(0===e.length)return()=>{};const n=()=>t(c);return"*"===e[0]?(s.has("*")||s.set("*",new Set),s.get("*").add(n),()=>{var t;return null===(t=s.get("*"))||void 0===t?void 0:t.delete(n)}):(e.forEach((t=>{s.has(t)||s.set(t,new Set),s.get(t).add(n)})),()=>{e.forEach((t=>{var e;return null===(e=s.get(t))||void 0===e?void 0:e.delete(n)}))})},middleware:t=>{o.push(t)},acts:u}}function o(o){const r=()=>{const[,t]=n((()=>({})),{});return t},i=s(o);return Object.assign(Object.assign({},i),{use:function(t){return c((e=>i.subscribe(e,t?[t]:["*"])),(()=>t?i.get(t):i.get()))},useRerender:r,useSelector:function(n,c){const s=r(),o=t(n(i.get()));return e((()=>{const t=t=>{const e=n(t);e!==o.current&&(o.current=e,s())},e=i.subscribe(t,c);return t(i.get()),e}),[n,c.join()]),o.current}})}function r(t){return function(e,n){return t.call(this,e,n)}}const i={createNexus:s,createReactNexus:o,createActs:r};export{r as createActs,s as createNexus,o as createReactNexus,i as default};
