import{useRef as t,useEffect as e,useReducer as n,useSyncExternalStore as o}from"react";function c(t){const{state:e,acts:n}=t;let o=Object.assign({},e);const c=new Map,s=[],r=t=>{var e;"*"===t?c.forEach((t=>t.forEach((t=>t())))):(t.forEach((t=>{var e;return null===(e=c.get(t))||void 0===e?void 0:e.forEach((t=>t()))})),null===(e=c.get("*"))||void 0===e||e.forEach((t=>t())))};function i(t){return void 0!==t?o[t]:o}const a=(t,e)=>{const n=Object.assign({},o),c="object"==typeof e?e:e?{source:e}:void 0,i="function"==typeof t?t(n):t;let a=Object.assign(Object.assign({},o),i);for(const t of s){const e=t(n,a,c);void 0!==e&&(a=e)}const u=[];for(const t in a)Object.prototype.hasOwnProperty.call(a,t)&&o[t]!==a[t]&&u.push(t);u.length&&(o=a,r(u))},u={};if(Array.isArray(n))for(const t of n){const e=t.call(u,i,a);e&&"object"==typeof e&&Object.assign(u,e)}else if("function"==typeof n){const t=n.call(u,i,a);t&&"object"==typeof t&&Object.assign(u,t)}for(const t of Object.keys(u)){const e=u[t];"function"==typeof e&&(u[t]=e.bind(u))}return{get:i,set:a,reset:function(...t){if(0===t.length)o=Object.assign({},e),r("*");else{const n={};for(const o of t)o in e&&(n[o]=e[o]);o=Object.assign(Object.assign({},o),n),r(t)}},subscribe:(t,e)=>{if(0===e.length)return()=>{};const n=()=>t(o);return"*"===e[0]?(c.has("*")||c.set("*",new Set),c.get("*").add(n),()=>{var t;return null===(t=c.get("*"))||void 0===t?void 0:t.delete(n)}):(e.forEach((t=>{c.has(t)||c.set(t,new Set),c.get(t).add(n)})),()=>{e.forEach((t=>{var e;return null===(e=c.get(t))||void 0===e?void 0:e.delete(n)}))})},middleware:t=>{s.push(t)},acts:u}}function s(s){const r=()=>{const[,t]=n((()=>({})),{});return t},i=c(s);return Object.assign(Object.assign({},i),{use:function(t){return o((e=>i.subscribe(e,t?[t]:["*"])),(()=>t?i.get(t):i.get()))},useRerender:r,useSelector:function(n,o){const c=r(),s=t(n(i.get()));return e((()=>{const t=t=>{const e=n(t);e!==s.current&&(s.current=e,c())},e=i.subscribe(t,o);return t(i.get()),e}),[n,o.join()]),s.current}})}function r(t){return function(e,n){return t.call(this,e,n)}}const i={createNexus:c,createReactNexus:s,createActs:r};export{r as createActs,c as createNexus,s as createReactNexus,i as default};
